<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Page</title>
    <style>
        *{
            margin: 0px;
            padding: 0px;
            box-sizing: border-box;
        }
        #navbar{
            width: 100%;
            height: 60px;
            background-color: antiquewhite;
            display: flex;
            justify-content: space-around;
            align-items: center;
            font-size: 20px;
        }
        #product_container{
            display: grid;
            grid-template-columns: repeat(4 , 1fr);
            grid-template-rows: auto;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }
        #product_container>div>img{
            width: 100%;
        }
        #product_container>div>h3{
            text-align: center;
        }
        #product_container>div>p{
            text-align: center;
        }
        #product_container>div>div{
            margin-left: 50%;
            cursor: pointer;
        }
        #pagination{
            display: flex;
            width: 10%;
            margin: auto;
            margin-top: 20px;
        }
        #prev{
            width: 100px;
        }
        #next{
            width: 100px;
        }
        #curr{
            width: 40px;
            text-align: center;
        }
    </style>
</head>
<body>
    <nav id="navbar">
        <a href="index.html">Products</a>
        <a href="wishlist.html">Wishlist</a>
    </nav>

    <div id="filterAndSort">

        <select name="" id="sort" onchange="sort()" >
            <option value="">Sort by Price</option>
            <option value="All">Show All</option>
            <option value="H2L">High to Low</option>
            <option value="L2H">Low to High</option>
        </select>

     <select name="" id="filterByCat" onchange="filterMyPro()">
        <option value="kids">Kids</option>
        <option value="women">Women</option>
        <option value="homedecor">Homedecor</option>
     </select>
    </div>

    <div id="product_container"></div>

    <div id="pagination">
        <button id="prev">Prev</button>
        <p id="curr"></p>
        <button id="next">Next</button>
    </div>

    <script>
        let category;
        let data ;
        let page=1;
        let limit =12;
       let getData = async () => {
        let res = await fetch(`https://dbioz2ek0e.execute-api.ap-south-1.amazonaws.com/mockapi/get-products?page=${page}&limit=${limit}&category=${category}`);
         data = await res.json();
        appendData(data.data)
        console.log(data.data)
       }
       getData()

       let arrOfFetchedData = JSON.parse(localStorage.getItem("wishlist")) || [];

       let appendData = (data) => {
        let cont = document.getElementById("product_container");
        cont.innerHTML = "";

        data.forEach((el,i) => {
            let box = document.createElement("div");

            let image = document.createElement("img");
            image.src = el.image;

            let brand = document.createElement("h3");
            brand.innerText = el.brand;

            let title = document.createElement("p");
            title.innerText = el.title;

            let category = document.createElement("p");
            category.innerText = el.category;

            let price = document.createElement("p");
            price.innerText = el.price;

            let wish = document.createElement("div");
            wish.innerText = "❤";
            wish.addEventListener("click" , () => {
                arrOfFetchedData.push(el);
                localStorage.setItem("wishlist" , JSON.stringify(arrOfFetchedData));
            })

            box.append(image,brand,title,category,price,wish);
            cont.append(box)
        })
       }

       async function filterMyPro(){
        let filterProd = document.getElementById("filterByCat");
        let temp = await data;
        temp = temp.data;
        if(filterProd.value === "kids"){
               category = `kids`;
               appendData(temp)
        }else if(filterProd.value === "women"){
            category = `women`;
            appendData(temp)
        }else if(filterProd.value === "homedecor"){
            category = `homedecor`
            appendData(temp)
        }
       }

       async function sort(){
        let sortData = document.getElementById("sort").value;
        let temp = await data;
        temp = temp.data
        if(sortData === "All"){
            appendData(temp);
        }else if(sortData === "H2L"){
            temp.sort(function(a,b){
               return b.price - a.price;
            })
            appendData(temp)
        }else if(sortData === "L2H"){
            temp.sort(function(a,b){
                return a.price - b.price;
            })
            appendData(temp)
        }
       }

       pagination();
       function pagination(){
        let currPage = document.getElementById("curr")
       currPage.innerText = page
      let previous = document.getElementById("prev");
      previous.addEventListener("click" , () => {
        page=page-1;
        
      });
      let nextPage = document.getElementById("next");
      nextPage.addEventListener("click" , () => {
        page=page+1;
        
      })
      appendData(data.data)
       }
        
       
    </script>
</body>
</html>